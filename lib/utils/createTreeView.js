"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.createTreeView = createTreeView;

var _uuid = require("uuid");

var _index = require("./index");

function createTreeView(key) {
  return function (items) {
    var tree = [];
    items.reduce(function (acc, cur) {
      var token = (0, _index.tokenize)(cur[key]);
      var index = acc.findIndex(function (item) {
        return item._cacheKey === token;
      });

      if (index === -1) {
        var length = acc.push({
          id: (0, _uuid.v4)(),
          name: cur.name,
          children: [],
          _cacheKey: token
        });
        index = length - 1;
      }

      acc[index].children.push(cur);
      acc[index].children.map(function (item) {
        item.children = item.accessRights.map(function (child) {
          return {
            id: (0, _uuid.v4)(),
            functionId: item.id,
            accessRightId: child.id,
            name: child.name,
            parent: item.name
          };
        });
        return item;
      });
      return acc;
    }, tree);
    return tree;
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy91dGlscy9jcmVhdGVUcmVlVmlldy50cyJdLCJuYW1lcyI6WyJjcmVhdGVUcmVlVmlldyIsImtleSIsIml0ZW1zIiwidHJlZSIsInJlZHVjZSIsImFjYyIsImN1ciIsInRva2VuIiwiaW5kZXgiLCJmaW5kSW5kZXgiLCJpdGVtIiwiX2NhY2hlS2V5IiwibGVuZ3RoIiwicHVzaCIsImlkIiwibmFtZSIsImNoaWxkcmVuIiwibWFwIiwiYWNjZXNzUmlnaHRzIiwiY2hpbGQiLCJmdW5jdGlvbklkIiwiYWNjZXNzUmlnaHRJZCIsInBhcmVudCJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztBQUNBOztBQU1PLFNBQVNBLGNBQVQsQ0FBd0JDLEdBQXhCLEVBQXFDO0FBQzFDLFNBQU8sVUFBVUMsS0FBVixFQUFxRTtBQUMxRSxRQUFNQyxJQUFJLEdBQUcsRUFBYjtBQUVBRCxJQUFBQSxLQUFLLENBQUNFLE1BQU4sQ0FBYSxVQUFVQyxHQUFWLEVBQWVDLEdBQWYsRUFBb0I7QUFDL0IsVUFBTUMsS0FBSyxHQUFHLHFCQUFTRCxHQUFHLENBQUNMLEdBQUQsQ0FBWixDQUFkO0FBQ0EsVUFBSU8sS0FBSyxHQUFHSCxHQUFHLENBQUNJLFNBQUosQ0FBYyxVQUFDQyxJQUFEO0FBQUEsZUFBVUEsSUFBSSxDQUFDQyxTQUFMLEtBQW1CSixLQUE3QjtBQUFBLE9BQWQsQ0FBWjs7QUFFQSxVQUFJQyxLQUFLLEtBQUssQ0FBQyxDQUFmLEVBQWtCO0FBQ2hCLFlBQU1JLE1BQU0sR0FBR1AsR0FBRyxDQUFDUSxJQUFKLENBQVM7QUFDdEJDLFVBQUFBLEVBQUUsRUFBRSxlQURrQjtBQUV0QkMsVUFBQUEsSUFBSSxFQUFFVCxHQUFHLENBQUNTLElBRlk7QUFHdEJDLFVBQUFBLFFBQVEsRUFBRSxFQUhZO0FBSXRCTCxVQUFBQSxTQUFTLEVBQUVKO0FBSlcsU0FBVCxDQUFmO0FBT0FDLFFBQUFBLEtBQUssR0FBR0ksTUFBTSxHQUFHLENBQWpCO0FBQ0Q7O0FBRURQLE1BQUFBLEdBQUcsQ0FBQ0csS0FBRCxDQUFILENBQVdRLFFBQVgsQ0FBb0JILElBQXBCLENBQXlCUCxHQUF6QjtBQUVBRCxNQUFBQSxHQUFHLENBQUNHLEtBQUQsQ0FBSCxDQUFXUSxRQUFYLENBQW9CQyxHQUFwQixDQUF3QixVQUFDUCxJQUFELEVBQVU7QUFDaENBLFFBQUFBLElBQUksQ0FBQ00sUUFBTCxHQUFnQk4sSUFBSSxDQUFDUSxZQUFMLENBQWtCRCxHQUFsQixDQUFzQixVQUFDRSxLQUFEO0FBQUEsaUJBQVk7QUFDaERMLFlBQUFBLEVBQUUsRUFBRSxlQUQ0QztBQUVoRE0sWUFBQUEsVUFBVSxFQUFFVixJQUFJLENBQUNJLEVBRitCO0FBR2hETyxZQUFBQSxhQUFhLEVBQUVGLEtBQUssQ0FBQ0wsRUFIMkI7QUFJaERDLFlBQUFBLElBQUksRUFBRUksS0FBSyxDQUFDSixJQUpvQztBQUtoRE8sWUFBQUEsTUFBTSxFQUFFWixJQUFJLENBQUNLO0FBTG1DLFdBQVo7QUFBQSxTQUF0QixDQUFoQjtBQVFBLGVBQU9MLElBQVA7QUFDRCxPQVZEO0FBWUEsYUFBT0wsR0FBUDtBQUNELEtBOUJELEVBOEJHRixJQTlCSDtBQWdDQSxXQUFPQSxJQUFQO0FBQ0QsR0FwQ0Q7QUFxQ0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyB2NCBhcyB1dWlkIH0gZnJvbSBcInV1aWRcIjtcbmltcG9ydCB7IHRva2VuaXplIH0gZnJvbSBcIi4vaW5kZXhcIjtcbmltcG9ydCB7XG4gIEZ1bmN0aW9uYWxpdHlDb250cmFjdCxcbiAgRnVuY3Rpb25hbGl0eVRyZWVDb250cmFjdCxcbn0gZnJvbSBcIi4uL3NwZWMvRnVuY3Rpb25hbGl0eUNvbnRyYWN0XCI7XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVUcmVlVmlldyhrZXk6IHN0cmluZykge1xuICByZXR1cm4gZnVuY3Rpb24gKGl0ZW1zOiBGdW5jdGlvbmFsaXR5Q29udHJhY3RbXSk6IEZ1bmN0aW9uYWxpdHlUcmVlQ29udHJhY3Qge1xuICAgIGNvbnN0IHRyZWUgPSBbXTtcblxuICAgIGl0ZW1zLnJlZHVjZShmdW5jdGlvbiAoYWNjLCBjdXIpIHtcbiAgICAgIGNvbnN0IHRva2VuID0gdG9rZW5pemUoY3VyW2tleV0pO1xuICAgICAgbGV0IGluZGV4ID0gYWNjLmZpbmRJbmRleCgoaXRlbSkgPT4gaXRlbS5fY2FjaGVLZXkgPT09IHRva2VuKTtcblxuICAgICAgaWYgKGluZGV4ID09PSAtMSkge1xuICAgICAgICBjb25zdCBsZW5ndGggPSBhY2MucHVzaCh7XG4gICAgICAgICAgaWQ6IHV1aWQoKSxcbiAgICAgICAgICBuYW1lOiBjdXIubmFtZSxcbiAgICAgICAgICBjaGlsZHJlbjogW10sXG4gICAgICAgICAgX2NhY2hlS2V5OiB0b2tlbixcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaW5kZXggPSBsZW5ndGggLSAxO1xuICAgICAgfVxuXG4gICAgICBhY2NbaW5kZXhdLmNoaWxkcmVuLnB1c2goY3VyKTtcblxuICAgICAgYWNjW2luZGV4XS5jaGlsZHJlbi5tYXAoKGl0ZW0pID0+IHtcbiAgICAgICAgaXRlbS5jaGlsZHJlbiA9IGl0ZW0uYWNjZXNzUmlnaHRzLm1hcCgoY2hpbGQpID0+ICh7XG4gICAgICAgICAgaWQ6IHV1aWQoKSxcbiAgICAgICAgICBmdW5jdGlvbklkOiBpdGVtLmlkLFxuICAgICAgICAgIGFjY2Vzc1JpZ2h0SWQ6IGNoaWxkLmlkLFxuICAgICAgICAgIG5hbWU6IGNoaWxkLm5hbWUsXG4gICAgICAgICAgcGFyZW50OiBpdGVtLm5hbWUsXG4gICAgICAgIH0pKTtcblxuICAgICAgICByZXR1cm4gaXRlbTtcbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4gYWNjO1xuICAgIH0sIHRyZWUpO1xuXG4gICAgcmV0dXJuIHRyZWU7XG4gIH07XG59XG4iXX0=